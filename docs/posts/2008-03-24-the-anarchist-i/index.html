<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tom Slee">
<meta name="dcterms.date" content="2008-03-24">

<title>The Anarchist in the Library – Tom Slee</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../logo.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
<meta name="twitter:title" content="The Anarchist in the Library – Tom Slee">
<meta name="twitter:description" content="Personal web site">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Tom Slee</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../essays.html"> 
<span class="menu-text">Essays</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../uncertainties.html"> 
<span class="menu-text">Uncertainties</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://tomslee.github.io/ridehail/lab/"> 
<span class="menu-text">Ridehail Lab</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Whimsley (blog archive)</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/tomslee"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/whimsley"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">The Anarchist in the Library</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">blog archive</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Tom Slee </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 24, 2008</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
        
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This page has been migrated from an earlier version of this site. Links and images may be broken.</p>
</div>
</div>
<p><a href="http://www.perseusbooksgroup.com/basic/book_detail.jsp?isbn=0465089852"><em>The Anarchist in the Library</em></a>, Siva Vaidhyanathan, Basic Books 2004.</p>
<hr>
<p>Siva Vaidhyanathan (see <a href="http://www.googlizationofeverything.com/">here</a> and <a href="http://www.sivacracy.net/">here</a>) sees the central problem of the Internet and of society as a whole, as the tension between decentralization/freedom/anarchy and centralization/control/oligarchy.</p>
<blockquote class="blockquote">
The great challenge in the new century is to mediate between two divergent trends – anarchy and oligarchy. In the war between distribution and concentration of information, the issues and conflicts seem intractable. [xvii] &gt; &gt;
</blockquote>
<p>In the world of the Internet, at least in the years leading up to 2004 when the book was published, these poles of anarchy and oligarchy manifest themselves technologically. Anarchy is the “ideology of peer-to-peer systems” such as the file-sharing and media-sharing networks that have followed Napster; it is characterized by a fluid, decentralized architecture in which “all the ‘thinking’.. happens at the end point” and in which there is “no discernible command-and-control system” [17]. On the other side, digital rights management is the technology of oligarchy, imposing controls on what you can and cannot do with the software and media that you buy (or, increasingly, license). I don’t usually buy the technology-determines-behaviour line, but his discussion of what it means for a technology to “have an ideology” is the best I’ve read, and is well illustrated by the distinction between technologies that operate on the basis of protocols (handshakes, conventions) and those that work on the basis of controls.</p>
<p>When I first picked up this book (from my library) I assumed that the author was another techno-utopian and that he is firmly on the side of freedom and anarchy over control and oligarchy (as who but the most unromantic of us could not be)? Not unreasonable, given chapter titles like_ Hacking the Currency_ and <em>The Peer-to-Peer Revolution and the Future of Music</em>, but wrong. In fact, although his heart is with the anarchists, Siva Vaidhyanathan is best described as a librarian. Not as in somebody who works in a library, but as in someone who is a fan of libraries:</p>
<blockquote class="blockquote">
Librarians should be our heroes. The library is not just functionally important to communities all over the world; it embodies Enlightenment values in the best sense. A library is a temple devoted to the antielitist notion that knowledge should be cheap if not free – doors should be open. Supporting libraries – monetarily, spiritually, intellectually, and legally – is one of the best things we can do for the life we hope to build for the rest of the century. [Page 119] &gt; &gt;
</blockquote>
<p>Libraries seem anachronistic – if they did not already exist, they could not be created now (in North America anyway) – and yet they are among the most popular of institutions. People make jokes (deserved or not) about the service of the post office, the inflexibility of government, and the so on, but no one (well, apart from <a href="http://www.imdb.com/title/tt0697721/">Seinfeld</a>) pokes fun at libraries. Even <a href="http://www.marginalrevolution.com/marginalrevolution/2007/09/library-appreci.html">some libertarians</a>, who see any path laid by the state as a road to serfdom, love libraries. Our <a href="http://www.kpl.org/">local</a> <a href="http://www.wpl.ca/">libraries</a> are always busy, and after a bad patch some time ago appear to be thriving with their mix of Internet access, DVD and CD rentals and, of course, loads of books. The popularity of the library surely comes from its nature as patron-focused but not commercial (no “consumers” here) and state sponsored but not monopolistic. It is populist and yet highbrow.</p>
<p>In the end Vaidhyanathan takes a dialectical stance and rejects both anarchy and oligarchy in favour of the library - a civic, noncommercial, open and public model. I didn’t see this coming until well into the book, which after the first couple of chapters is more a set of essays around a common topic than a sequential argument. I thought he was heading towards one more simplistic agenda (“information wants to be free” anyone?) but he pulls himself back from the brink and ends up writing [185] “The heart of my argument in this book is a call for modesty and patience” and this:</p>
<blockquote class="blockquote">
The urge to break heads, to do the bidding of oligarchy by any means necessary is intimately linked to specters of anarchy. The urge towards anarchy depends on oligarchic abuses. Each creates the conditions that allow the other to thrive. The question for us in the twenty–first century should not be choosing anarchy or oligarchy by constructing and maintaining systems that discourage both. Anarchy is a reaction, not a vision or solution that can produce the best society and the best human future. [187] &gt; &gt;
</blockquote>
<p>One of the reasons he pulls back is a debate with Randy Cohen of the <em>New York Times</em>, which he describes with admirable honesty [63].</p>
<blockquote class="blockquote">
“The history of popular culture is a continuous struggle on the artists’ part not to get robbed… it seems to me that what MP3 [digital music] does is democratize the ability to rip off an artist,” Cohen wrote to me. “And what’s particularly galling is that you not only want to do it, you want to be praised as a social progressive when you do.”<br>
He got me. That’s my schtick. By the guiding principles Cohen deployed in our peer-to-peer debate, I had no escape. He considered copyright to be an artists’ right and concern; I consider the chief player in the copyright system to be the corporation. &gt; &gt;
</blockquote>
<p>The artists’ struggle continues. The commercial oligarchs do whatever they can to avoid paying artists, as the Hollywood writers’ strike showed and as <a href="http://www.nypost.com/seven/02272008/business/infringement__99428.htm">recent press</a> about royalty awards not being passed on to artists makes clear. But the free-use techno-anarchists exploit artists too. Greatest Living Englishman Billy Bragg <a href="http://www.nytimes.com/2008/03/22/opinion/22bragg.html">writes</a> in the New York Times about how he advised Michael Birch, the founder of social networking site Bebo.com, on how to handle artistic content on the site (via <a href="http://www.roughtype.com/archives/2008/03/meanwhile_back.php">Nicholas Carr</a>). Bragg was angry that while artists contributed to the site, Michael Birch sold it to AOL for $850million and the artists got nothing. Here is part of his op-ed:</p>
<blockquote class="blockquote">
<p>He was hoping to expand his business by hosting music and wanted my advice on how to construct an artist-centered environment where musicians could post original songs without fear of losing control over their work. Following our talks, Mr.&nbsp;Birch told the press that he wanted Bebo to be a site that worked for artists and held their interests first and foremost. &gt; &gt;</p>
<blockquote class="blockquote">
<p>In our discussions, we largely ignored the elephant in the room: the issue of whether he ought to consider paying some kind of royalties to the artists. After all, wasn’t he using their music to draw members — and advertising — to his business? Social-networking sites like Bebo argue that they have no money to distribute — their value is their membership. Well, last week Michael Birch realized the value of his membership. I’m sure he’ll be rewarding those technicians and accountants who helped him achieve this success. Perhaps he should also consider the contribution of his artists.</p>
</blockquote>
<blockquote class="blockquote">
<p>The musicians who posted their work on Bebo.com are no different from investors in a start-up enterprise. Their investment is the content provided for free while the site has no liquid assets. Now that the business has reaped huge benefits, surely they deserve a dividend…</p>
</blockquote>
<blockquote class="blockquote">
<p>If young musicians are to have a chance of enjoying a fruitful career, then we need to establish the principle of artists’ rights throughout the Internet — and we need to do it now.</p>
</blockquote>
</blockquote>
<p>Instead of cheering for one side or the other, Vidhyanathan’s book foresees and acknowledges both these problems. And problems they are. He does not offer clear or simple solutions, but he points us thoughtfully in the right direction, and that’s a very valuable contribution. So I definitely recommend the book, even though I wish it were a bit less scattered than it is (and that it had a better index). It’s an exploration, not a recipe for the future, and has the rough edges that come with that territory, but there is a lot of food for thought in the pages.</p>
<p><em>The Anarchist in the Library</em>, written in 2004, is already a bit outdated. Not the author’s fault of course, but it is already odd to read a book about the Internet that has no mention of Wikipedia and no index entry for Google. These recent developments have changed the nature of the Internet. Peer to peer networks are still around, but I don’t think they are the defining feature of the Internet. If we think of music we think of iTunes, not Napster; if we think of books we think of Amazon; if we think of social networks we think of Facebook and MySpace. None of these are peer-to-peer: they are centralized technologies built on the basis of controls, not protocols. Software architecture is often described as a stack, and while the low-level plumbing of the Internet remains a peer to peer protocol, the higher levels of the stack are “platforms” or client-server models of request and response. The techno-capitalist digirati have moved happily onto such platforms, and the centralization of ownership that they carry with them. In the era of <a href="http://www.nicholasgcarr.com/bigswitch/">utility computing</a>, peer-to-peer networks appear to be on the wane.</p>
<p>There is one other place in which I think Vaidhyanathan gets it wrong. He underestimates the role of information asymmetries and transaction costs. He says that “Major record labels perform four basic tasks: production, distribution, price fixing, and gatekeeping” [48]. But there is a fifth, which is promotion. Simply putting a record on the Internet is hardly more effective than playing your music on your front lawn - the problems of finding something no one knows exists are far greater than he credits. One major function of libraries, after all, is to match readers and books (“Every reader his/her book” in one of Ranganathan’s <a href="http://www.slais.ubc.ca/COURSES/libr517/03-04-wt2/projects/ranganathan/contri.htm">five laws of library science</a> – thanks John). When Vaidhyanathan tells a journalist that African musicians don’t need record companies because “The artists can do it all themselves for less than $10,000” he is naive. Billy Bragg’s friends on Bebo did the same, and it got them nowhere. Others have proclaimed this line before - for example Chris Anderson in <a href="http://whimsley.typepad.com/whimsley/2007/03/the_long_tail_l.html">my least favourite book</a> talks about the band Birdmonster who eschewed labels</p>
<blockquote class="blockquote">
<p>Label were calling with deals, but Birdmonster turned the offers down. As [lead singer Peter] Arcuni put it, “We’re not anti-label in principle, but the numbers (risk vs.&nbsp;reward) didn’t add up.” &gt; &gt; A music label exists primarily to fulfill four functions: 1) talent scouting; 2) financing (the advances bands get to pay for their studio time is like seed capital invested by a venture capitalist); 3) distribution; 4) marketing. &gt; &gt;</p>
<blockquote class="blockquote">
<p>From Birdmonster’s perspective, they didn’t need that.</p>
</blockquote>
</blockquote>
<p>Well, apparently <a href="http://www.longtail.com/the_long_tail/2008/03/follow-up-a-lon.html">they do now</a>. The problem is that so much of culture is governed by asymmetric information, information cascades, and network effects. You don’t know what a book is going to be like until you buy it, so simply knowledge of the existence of a book is insufficient - you need recommendations and reliable ones at that. I’ve gone on about this in various ways <a href="http://whimsley.typepad.com/whimsley/2008/03/long-tail-of-ne.html">here</a> and <a href="http://whimsley.typepad.com/whimsley/2007/04/predicting_hits.html">here</a> and <a href="http://whimsley.typepad.com/whimsley/2006/07/movies_nobody_k.html">here</a>. His neglect of these forces is one of the reasons I thought he was heading down the techno-utopian path, but as I say he ends up, thankfully, rejecting the “California Ideology” [155] in favour of something less catchy, less simple, but more hopeful.</p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>2023 – 2024, Tom Slee</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>