<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tom Slee">
<meta name="dcterms.date" content="2007-03-05">

<title>The Long Tail 6 - The New Markets – Tom Slee</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../logo.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
<meta name="twitter:title" content="The Long Tail 6 - The New Markets – Tom Slee">
<meta name="twitter:description" content="Personal web site">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Tom Slee</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../essays.html"> 
<span class="menu-text">Essays</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../uncertainties.html"> 
<span class="menu-text">Uncertainties</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://tomslee.github.io/ridehail/lab/"> 
<span class="menu-text">Ridehail Lab</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Whimsley (blog archive)</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/tomslee"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/whimsley"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">The Long Tail 6 - The New Markets</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">blog archive</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Tom Slee </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 5, 2007</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
        
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This page has been migrated from an earlier version of this site. Links and images may be broken.</p>
</div>
</div>
<p>This is another part of my critical reader’s companion to <em>The Long Tail</em>, and it discusses Chapter 6 - The New Markets. Part 0 is <a href="http://whimsley.typepad.com/whimsley/2007/02/my_next_several.html">here</a>. You can find a complete list of the Long Tail pieces <a href="http://whimsley.typepad.com/whimsley/the_long_tail/index.html">here</a>. You have to read upwards, in usual blog fashion. When I get to the end I hope to put these all together in one big file for download.</p>
<hr>
<p>Bored of this yet? Well that’s just too bad, because this blog is nothing but The Long Tail until I’ve gone through the whole thing, repetition and tedium be damned. So if you don’t like that, come back in about three or four weeks if things go according to plan.</p>
<p>Still here? Great. Glad to have you. It is time to cast your mind back and recall that Chapter 4 spelled out the Three Forces of the Long Tail and that Chapter 5 was about the first one: Production. Chapter 6, today’s subject, is about the second force: distribution. And whereas Chapter 5 was bolted on to the side of the Long Tail hypothesis, Chapter 6 is right in the middle of it. It’s about Internet aggregators, in particular Amazon, and how they go about filling their long shelves.</p>
<p>The first section of the chapter is one of the more interesting stories in the book. It’s about the success, at the third attempt, of <a href="http://www.alibris.com/">Alibris</a>, a company that seeks to “deliver the growing power of e-commerce to independent booksellers while delivering extraordinary selection to businesses and book lovers” (from the Alibris web site). The used book market (other than university textbooks) is fine if you are a browser hoping to stumble across a quirky find, but problematic for people looking for a particular book because there are “not enough sellers and buyers of an unbounded set of commodities” [87]. As a result, the odds of finding your book are slim. “Thus, most buyers simply never consider a used-book store when they’re shopping for something specific” [87].</p>
<p>Alibris takes the inventory of used book stores, gathers them together, and puts this big database online, making it available to Amazon and other online outlets such as bn.com, where used books appear alongside new books when customers search for a book. The result is a fast-growing used-book industry (11% in the US in 2004) [88]. This story shows what the Internet is good at: bringing unconnected people together. It sounds like, and maybe is, a hopeful story, “creating a liquid market where there was an illiquid market before” [88]. (Aside - it is odd that Anderson talks about the American Alibris and completely neglects its <a href="http://technology.guardian.co.uk/online/howto/story/0,,1433850,00.html">bigger</a> Canadian competitor <a href="http://www.abebooks.com">Abebooks</a>, who now own the fine <a href="http://www.librarything.com">librarything</a> web site, but perhaps he is subject to the tyranny of geography in the physical world).</p>
<p>It is likely that a move to used book buying and selling is a pretty diverse market compared to new books, but it may be of interest to note that the Alibris founder <a href="http://www.ioba.org/newsletter/archive/v13/tb1.php">says</a>, in discussing a new Alibris pricing initiative that ” It’s true that the Alibris Pricing Service really is oriented mainly around common books - but that’s more than 80% of the demand out there, so it tackles the vast majority of the market”. Alibris is a private company and does not make its detailed sales figures available, so it is difficult to know for sure. But used books are one of those areas where the Long Tail hypothesis has the strongest ring of truth.</p>
<p>Enter the Aggregators [88-89] picks up from the Alibris example and uses it as an example of a “Long Tail ‘aggregator’ - a company or service that collects a huge variety of goods and makes them available and easy to find” [88]. And the Alibris story shows that there are ways in which the Internet can pull people together. But while aggregation can be a fine thing, it does have a dark side, and that side is market power. Canny aggregators know this. Alibris, for example, does not put its customers in touch with the used book stores that actually sell the books. Instead, the book store owner sends their book to Alibris, who then sends it on to the customer. In this way, Alibris becomes the hub of the market: the central repository of knowledge, while the individual book stores who it relies on are <a href="http://booksellingonlineblog.com/2006/03/15/alibris-makes-me-gag-again/">kept in the dark</a>. This appears to have led to some <a href="http://palimpsest.stanford.edu/byform/mailing-lists/exlibris/1999/11/msg00135.html">resentment</a> amongst some librarians and book store owners, although I have no idea how widespread this is.</p>
<p>What this means is that online aggregators become the new powerhouse in the industries they move into. Amazon in the world of new books, Abebooks and Alibris in the world of used books, and so on. Google, of course, is seeking to aggregate everything and so become the hub for “the world’s information”.</p>
<p>This is a mixed development for those whose information is being aggregated. Newspapers, for example, are <a href="http://blogs.guardian.co.uk/technology/archives/2007/02/13/google_news_loses_belgian_newspaper_case.html">not thrilled</a> at the idea of <a href="http://news.google.com">Google News</a> presenting their information freely to the world, while the newspapers themselves struggle over lost income. With Google making scads of advertising money off presenting information to people, it looks like the balance of power has shifted from the content originators to aggregators.</p>
<p>Aggregators are here to stay. What remains to be seen, however, is if they bring with them any real move towards a more diverse pattern of demand and consumption.</p>
<p>So aggregators are the Long Tail enterprises that represent “the future of business”, and Anderson says “there are literally thousands of them” [88]. Are we now going to hear about the wave of the future, and see what shape it is taking?</p>
<p>No.&nbsp;Frustratingly, the only examples he lists after that teasing sentence are our old friends Google, Rhapsody, iTunes, Netflix and eBay – the same handful of companies he’s been going on about in the first few chapters. He does also mention Bloglines, an RSS feed aggregator, and Wikipedia, which I’ve argued is not an “aggregator of the Long Tail of knowledge” but those are the only ones of those “literally thousands” that he actually lists.</p>
<p>What he means by his “literally thousands” becomes clear when he says that “a single blog that collects all the information that it can about a topic, let’s say needlework, is an aggregator” [89]. Well, if this is where his “literally thousands” of aggregators are coming from, count me underwhelmed. Amazon is one thing, and someone collecting links on needlework is another. I mean, Wal-Mart puts things on shelves and I put things on shelves, but that doesn’t make me the same kind of thing as Wal-Mart. And although he mentioned needlework or “SEC filings or techno music” he does not actually list real sites. The wave of the future, it seems, is still intangible.</p>
<p>Anderson does tease us again by claiming that “in this chapter, I’ll focus on the business aggregators. They fall mostly into five categories:</p>
<ol type="1">
<li><p>Physical goods (eg Amazon, eBay)</p></li>
<li><p>Digital goods (eg iTunes, iFilm)</p></li>
<li><p>Advertising/services (eg Google, Craigslist)</p></li>
<li><p>Information (eg Google, Wikipedia)</p></li>
<li><p>Communities/user-created content (eg MySpace, Bloglines)” [89]</p></li>
</ol>
<p>The rest of the chapter, however, is devoted to a discussion of just one aggregator – Amazon (again!) with occasional mentions of old chums Netflix and Rhapsody. The fact that we are a third of the way into the book and, when it comes to specifics, Anderson keeps going back to the well to show us Amazon or Netflix one more time suggests that he is a little short of real examples, and that perhaps the aggregator model, while a powerful one for some people, is not something that is going to spawn large numbers of companies.</p>
<p>We’ve already seen (earlier chapters) that while Amazon does make more money off its “Long Tail” than individual brick and mortar stores, its figures are not spectacularly different after the downward revision between the original article and the published book, and that Rhapsody seems just as hit-dependent as HMV. When it comes down to it, we have here a short, limited list of examples which we’ve already seen provide little evidence for a significant Long Tail effect.</p>
<p>Hybrid versus Pure Digital [89-91] This section is devoted to a single rather obvious idea, which is that while it’s pretty cheap to sell physical goods from digital shelves (“hybrid retailer”), it’s even cheaper to sell digital goods from digital shelves (“pure digital retailer”) because such a good is just a row in a database table until someone orders it. This latter form of business is, he says “the holy grail of retail - near-zero marginal costs of manufacturing and distribution” [91]. Here, he actually mentions (unlike in the previous chapter) that it is marginal cost that is being minimized. He does not go on to point out that the industries with large fixed costs and tiny marginal costs tend to form oligopolies, but they do. It’s the main reason why there really aren’t “literally thousands” of aggregators and it’s why he has to go back to the same old examples over and over again. Fixed costs and other forms of increasing returns mean that there just aren’t that many of them.</p>
<p>Tripping Down the Tail [91-94] is also about Amazon (yawn), and shows how it is getting “closer and closer to breaking the tyranny of the shelf entirely” [94] by introducing Amazon Marketplace - a program in which the Amazon web site is a storefront for many small vendors (rather like eBay). “Retailers and distributors of any size, from specialty shops to individuals, could have their goods listed on Amazon.com just like the products in Amazon’s own warehouses - and the customers could buy either just as easily.” [93]</p>
<p>Amazon Marketplace shows the real appeal of the aggregator business model, and it’s not about Long Tail, it’s about One Big Virtual Tent (see yesterday’s post). Why? Because the Amazon Marketplace model gets Amazon itself out of the physical shelf business, even though as Anderson writes, apparently without noticing the implications (he really is an incurable optimist) “With the Amazon Marketplace form of distributed inventory, the products are still on shelves around the country, but they are collectively catalogued and offered in one central place - Amazon’s Web site. Then, when people order them, the products are boxed up and shipped directly to the customer by the small merchants who have held the inventory all along” [94 - my emphasis] and if the goods don’t sell “Amazon bears none of the cost – the surplus stock simply depreciates on the shelves of a third party” [94].</p>
<p>It is easy to see why this is a great deal for Amazon: they are using their market power to put the squeeze on the individual retailers whose very physical shelves are holding very physical products. Like Alibris, Amazon have <a href="http://www.bookthink.com/0086/86web.htm">put measures in place</a> to prevent customers and sellers communicating directly. They are the ones in charge of this relationship.</p>
<p>So Amazon Marketplace is yet another story with at most a tenuous relationship to the Long Tail thesis. It provides Amazon with another source of revenue, but it is not clear if or how it moves overall customer demand to a Long Tail in any significant way. Sales of small items are gravy for a site with the huge web site resources of Amazon, but Anderson does not say how much business has been done on Amazon Marketplace, whether the small suppliers (for whom it is one more outlet) are gaining or losing overall from any move online that has happened, and so on. If, for example, there is a move to online purchase of the kind of goods found on Amazon Marketplace, then it could make sense for individual retailers to put their items there (because any sale is better than no sale) and yet be worse off than they were before Internet selling came along. It’s just shoddy writing. And it doesn’t get better.</p>
<p>Inventory on Demand [94-96] is yet more Amazon smoke and mirrors. By this time it is really getting silly. Anderson talks about Amazon’s big commitment to print on demand publishing as a way of selling all those niche books. But while he notes that “the potential of print-on-demand is extraordinary” [96] he doesn’t give any real-world numbers. How many print-on-demand books does Amazon sell? Not a clue. Will it help publishers get past the problem of returns from physical stores or does POD have its own problems? Who knows? Not Anderson, that’s for sure. And then at the very end of the section he says that print-on-demand may also be useful for big sellers (hits) as well as niche products, so it may not actually “push demand down the long tail” at all. Remarkable.</p>
<p>The End of Inventory Altogether [96-97] is the final section of this chapter. It finally moves away from Amazon to talk about iTunes, Netflix and other pure-digital outlets as the wave of the future - which we have already seen are pretty hit-based. There is no doubt that the digital world is getting bigger, but this is not news. I for one am no cellulose sentimentalist and can’t wait for flexible <a href="http://www.engadget.com/2007/01/05/plastic-logic-to-build-first-electronic-paper-plant/">electronic</a> <a href="http://www.engadget.com/2007/01/16/toshiba-matsushita-electronic-paper-alternative-hits-mass-produc/">paper</a>, but when it gets here I hope there is something more solid than The Long Tail to read on it.</p>
<p>So there we are. Another chapter, another lack of real substance to Anderson’s thesis. It is clear that there is money to be made by aggregators, but not at all clear that the coming of the aggregators is the coming of “infinite choice” [180].</p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>2023 – 2024, Tom Slee</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>