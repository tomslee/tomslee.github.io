<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tom Slee">
<meta name="dcterms.date" content="2012-12-31">

<title>Peer-to-Peer Hucksterism: An Open Letter to Tim Wu – Tom Slee</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../logo.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
<meta name="twitter:title" content="Peer-to-Peer Hucksterism: An Open Letter to Tim Wu – Tom Slee">
<meta name="twitter:description" content="Personal web site">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Tom Slee</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../essays.html"> 
<span class="menu-text">Essays</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../inprogress.html"> 
<span class="menu-text">Uncertainties</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://tomslee.github.io/ridehail/lab/"> 
<span class="menu-text">Ridehail Lab</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Whimsley (blog archive)</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/tomslee"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/whimsley"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Peer-to-Peer Hucksterism: An Open Letter to Tim Wu</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">blog archive</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Tom Slee </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 31, 2012</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
        
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This page has been migrated from an earlier version of this site. Links and images may be broken.</p>
</div>
</div>
<pre><code>            Dear Tim Wu,</code></pre>
<p>Has something happened to your brain? Can your short article in the <em>New York Times</em>,&nbsp;<a href="http://www.nytimes.com/2012/12/20/opinion/the-best-way-to-regulate-urban-living-apps.html">Apps to Regulate Apps</a>, be the product of the same grey matter that produced the excellent “Who Controls the Internet?” and the admirable “The Master Switch”? What’s going on? I hope it was a momentary lapse and I hope you will change your mind about this sloppy and potentially damaging piece.</p>
<p>You were writing, as you know, about AirBnB and Uber: two new “peer-to-peer” companies building big businesses around apps that let you “book a car ride or rent someone’s apartment using your smartphone or computer”, and apparently&nbsp;<a href="http://www.thestar.com/news/gta/article/1298266--uber-taxi-charged-with-licensing-offences">breaking a few laws</a>&nbsp;along the way. You write that “no one can deny that these apps are responding to real demands and helping cities become easier to live in and visit”, and you place them on the side of Progress, and the Future; in contrast, the reactions of cities who have banned these apps “recall Ned Ludd’s response to the automated loom”.</p>
<p>While you do acknowledge that there are complaints about the companies, you decide that “many of the complaints are anecdotal”. But complaints are always anecdotal unless someone tallies them, and tallying them is, of course,&nbsp;one of the points of regulation:&nbsp;AirBnB and Uber are not tallying them, that’s for sure. They may even try to&nbsp;<a href="http://gawker.com/5825996/airbnb-pillage-victim-says-company-tried-to-keep-her-quiet">sweep them under the rug</a>&nbsp;in case it damages their valuation: exactly the kind of conflict of interest that make regulations necessary in the first place.</p>
<p>But let’s step back a bit. I’m no Valley Visionary, so if I were setting up a business based on offering unlicensed hospitality or cab rides, I might ask myself a few questions first. And I may ask myself: why is it that every town and city I’ve ever been to has licensing requirements for&nbsp;people offering taxi services or overnight accommodations? Is there a global taxi cartel or a multinational bed-and-breakfast conglomerate enforcing its will on municipalities from Aberystwyth to Yellowknife? And if there isn’t – and of course there isn’t, because taxi and B&amp;B operations are usually local and small-scale operations – I may ask myself: what’s behind all these rules?</p>
<p>And if I stopped for more than two minutes before seeking seed funding for my enterprise, I may tell myself about property zoning, about landlord-tenant agreements, about the risks run by customers who step into a taxi or a hotel in a strange city, about liability in the event of accidents, about the importance of equitable access, about complaints investigation, about safety checks, and more. Not, of course, that licensing is unproblematic in all cities – far from it – but these would at least be things I would wonder before proclaiming that those who stand in the way of my right to make a buck are simply Luddites. And if I were to advocate changing zoning regulations in cities throughout the world, and changing taxicab licensing rules too, with all the expense that comes with those changes, I’d have put a little thought into it. Especially because, as you say in your final sentence, “It is, in short, a time to think carefully”. Unfortunately, all the evidence is that AirBnB and Uber have not stopped to think, so the idea that they should set the agenda for civic licensing discussions, placing new stresses on the already-stretched finances of municipalities around the world, despite displaying such solipsistic lack of attention, is presumptuous at least and offensive at worst.</p>
<p>Unfortunately your two suggestions – that cities should require the companies to provide applications which could be used by landlords and co-op boards with a check on their tenants’ use of AirBnB, or that cities could “simply” require Uber to disclose information about its prices and traffic – do not even scratch the surface of the issues that need to be sorted out before AirBnB or Uber can be taken seriously as forward-thinking, sustainable partners in civic development. And I hope that, if you reflect, you’ll agree that the new peer-to-peer companies are a blight on the landscape of egalitarian thinking. Yes, according to&nbsp;<a href="http://tech.fortune.cnn.com/2012/05/03/airbnb-apartments-social-media/">CNN</a>, CEO Brian Chesky “thinks of Airbnb as more than a company – to him it is a movement. His site invites users to return to a time when hitchhiking wasn’t dangerous – when it was just fine to share anything with strangers because no one was all that strange.” But Brian Chesky has not tried to start a movement, he’s started a company: and he hasn’t actually done anything much to make hitchhiking less dangerous. He wants his customers to think of it as a movement while he owns the business. While they invoke the communitarian traditions of the informal economy, these new peer-to-peer companies are more likely to erode that economy than enhance it.</p>
<p>We all know the informal economy. I used to hitchhike to university, my neighbours have yard sales, friends help each other move house. None of this activity is regulated because it’s at most minimally commercial. But there is a line, of course: if I started having a yard sale every weekend then my neighbours might think I’m stretching a point and complain to the by-law people. If I rented my house to strangers week in and week out – for money – they might ask if I’m running a rooming house. And that’s assuming that the people renting my house aren’t&nbsp;<a href="http://www.nbcnews.com/travel/airbnb-rental-sweden-allegedly-used-temporary-brothel-944402">running a brothel</a>. So there is a trade-off here: informal activity for little or no money is OK. Commercial activity plays by different rules; a level of accountability is needed.</p>
<p>So now here comes AirBnB (to take one example), who want to keep the idea that it’s about the noncommercial and “sharing” informal economy, and scale it up. They talk about their hosts in a non-commercial sense: earning “additional income”, or “extra money” (<a href="http://www.theatlanticcities.com/housing/2012/08/micro-subletting-thriving-new-york-it-legal/2897/">link</a>) – rolling out, I could not help but notice, the very phrases used years ago to justify not giving women’s jobs the same protections and benefits as men’s jobs. It’s not the real economy, it’s just a bit of pocket money: we don’t need all those expensive rules and regulations. But they want to build a&nbsp;<a href="http://techcrunch.com/2012/09/26/airbnb-is-raising-a-big-third-round-aiming-for-a-valuation-north-of-2b/">billion dollar business</a>&nbsp;on the back of it. And while eBay famously did this for knick-knacks, the nature of the activities makes the two companies completely different. There are information asymmetries with serious consequences here. The model is that AirBnB take 10% of the booking fees and take&nbsp;<a href="http://www.digitaltrends.com/social-media/why-the-house-that-airbnb-built-stands-on-shaky-legal-ground/">0% of the responsibility</a>&nbsp;for what happens when you book, or hire, a room. Now many exchanges do go well, partly because the early stages of an activity like this do draw from a community of people who are committed to the non-commercial side of the action, but the success attracts others, and for personal safety in such cases (rare incidence but severe consequences)&nbsp;recommender systems are simply not the right tool. It’s&nbsp;not like Wikipedia (or eBay or Yelp) because you can’t just Undo an apartment-trashing, and the fact that AirBnB had not thought about what happens when an apartment is trashed shows, as Farhad Manjoo&nbsp;<a href="http://www.slate.com/articles/technology/technology/2011/08/renters_from_hell.html">writes</a>, that is simply wasn’t thinking. It didn’t care. And if Brian Chesky really thought about AirBnB as a movement, he’d care.</p>
<p>The questions are heightened by the contrast between the community-friendly rhetoric of the company and the apparent character of its founders. One has a reported history as a spam-merchant (that and more&nbsp;<a href="http://gawker.com/5853754/the-seedy-spammy-past-of-airbnbs-co+founder?tag=valleywag">from Ryan Tate</a>), and the financing has raised&nbsp;<a href="http://allthingsd.com/20111001/vcs-unite-chamath-palihapitiya-decries-airbnbs-recent-112m-funding-for-excessive-founder-control-and-cashout-in-email/">ethical questions</a>&nbsp;about the way in which early investors can take large amounts of money out of the business without diluting their control. The long and short of it is that the company runs as a scheme to make large amounts of money for a small number of people by appealing to large numbers of egalitarian-minded young people. Investment (and presumably board-level presence) from Andreessen-Horowitz, Yuri Milner, and now maybe Peter Thiel, all with well-known neo-liberal attitudes, makes this clear.</p>
<p>Your other company, Uber Taxi, has a similar litany of complaints: taking a&nbsp;<a href="http://gigaom.com/2012/10/05/chicago-cabbies-sue-hip-car-service-uber-for-pocketing-50-of-driver-tips/">50% cut of tip money</a>&nbsp;(illegal in many places),&nbsp;and&nbsp;<a href="http://pandodaily.com/2012/11/14/what-taxi-industry-outsiders-dont-get-about-vc-funded-taxi-apps/">more</a>. The “surge pricing” following Hurricane Sandy is a clear example of the eat-your-cake-and-have-it approach that characterizes these peer-to-peer businesses: the company&nbsp;<a href="http://pandodaily.com/2012/10/31/assholes-shrug/">adopts</a>&nbsp;hard-nosed Economics 101 pricing models (which we can argue about) while employing a rhetoric of community and sharing. You can have at most one or the other, but not both. Unsurprisingly it is run, as <a href="http://sethf.com/infothought/blog/">Seth Finkelstein</a> pointed out on my previous post, by&nbsp;<a href="http://pandodaily.com/2012/10/24/travis-shrugged/">an admirer of Ayn Rand</a>.</p>
<p>The contrast with real efforts to break down barriers to access and to make more accessible, non-commercial travel a reality is dramatic. None of the peer-to-peer companies “<a href="http://cbracy.tumblr.com/post/39314979304/silicon-valleys-problem">start from&nbsp;an entrenched social problem and work backwards from there</a>” as Catherine Bracy writes. For real inspirarion, look back to&nbsp;efforts like the Ramblers Association’s 1932&nbsp;<a href="http://en.wikipedia.org/wiki/Mass_trespass_of_Kinder_Scout">mass trespass of Kinder Scout</a>, the services provided over the years by the&nbsp;<a href="http://www.yha.org.uk/about-yha/yha-today">Youth Hostel Association</a>&nbsp;and&nbsp;<a href="http://en.wikipedia.org/wiki/Hostelling_International">Hostelling International</a>, all characterized by a broad base, by people who thought about what they were doing, and who had an actual commitment to their goals. And guess what? Remarkably enough, none of these has billionaire venture capitalists - or even the profit motive - behind them.</p>
<p>So, Tim. Back to the beginning. The Randian, simplistic free-market thoughtlessness behind the wave of “peer-to-peer” companies, and especially those who are trying to uproot regulations that protect consumers, is far from the wave of the future: it’s hucksterism masquerading as progress, hubris as vision, callous selfishness as community-mindedness, and it’s a disaster waiting to happen. I don’t think it’s something you want to associate yourself with. Will you retract your support for AirBnB and Uber?</p>
<p>yours,</p>
<p>Tom Slee</p>
<p>Written in Org version 7.8.10 with Emacs version 23</p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>2023 – 2024, Tom Slee</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>