<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tom Slee">
<meta name="dcterms.date" content="2007-02-18">

<title>The Long Tail 0.2 - Introduction – Tom Slee</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../logo.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
<meta name="twitter:title" content="The Long Tail 0.2 - Introduction – Tom Slee">
<meta name="twitter:description" content="Personal web site">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Tom Slee</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../essays.html"> 
<span class="menu-text">Essays</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../uncertainties.html"> 
<span class="menu-text">Uncertainties</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://tomslee.github.io/ridehail/lab/"> 
<span class="menu-text">Ridehail Lab</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Whimsley (blog archive)</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/tomslee"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/whimsley"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">The Long Tail 0.2 - Introduction</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">blog archive</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Tom Slee </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 18, 2007</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
        
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This page has been migrated from an earlier version of this site. Links and images may be broken.</p>
</div>
</div>
<p>This is part of my critical reader’s companion to <em>The Long Tail</em> and discusses the Introduction. Part 0 is <a href="http://whimsley.typepad.com/whimsley/2007/02/my_next_several.html">here</a>. The previous part in this series is <a href="http://whimsley.typepad.com/whimsley/2007/02/i_know_i_know_n.html">here</a>.</p>
<p>After taking two posts to get past the cover, you may be very glad to know I have nothing to say about the dedication page or the acknowledgments. This exercise will be long-winded enough without that. Yes, I’m ploughing on, turning pages recklessly past the Table of Contents and all the way to the Introduction. But I’ll stop there, and look at it closely.</p>
<p>The point of an Introduction is pretty similar to the cover. It’s to set out the main themes of the book, to sketch the argument, and so to draw the reader in. Some writers call it Chapter 1 (that’s what I did) and others don’t call it a chapter (that’s what Anderson does), including it as part of the front matter for the book.</p>
<p>Unsurprisingly then, some of the things I have to say here will repeat what I said about the cover. Anderson starts off by talking about the world we are in now, and this world is “the world the blockbuster built” [1]. (Remember, numbers in square brackets are page numbers in the book, not footnotes) But that world is “starting to tatter at the edges” [2].</p>
<p>I want to spend some time on a paragraph on page 2 where he backs up this claim that blockbusters have had their day. It’s not the only place he does this, and we’ll return to the question of whether blockbusters are “starting to, gasp, rule less” later, but this is the first time he attempts to bolster the claim. He writes that “Most of the top-fifty selling albums of all time were recorded in the seventies and eighties” [2]. (The end notes make it clear he is talking about the USA here. As elsewhere, most of his figures and data refer to the US.) Interesting, but what about other areas of culture? A parallel statement would be that most of the top-grossing movies of all time were in the same time period. But the top grossing film of all time is Titanic (1997) and even adjusted for inflation, the top box office hits <a href="http://www.boxofficemojo.com/alltime/adjusted.htm">are</a> Gone With the Wind, Star Wars, The Sound of Music, ET, The Ten Commandments, and Titanic - one each from the thirties, fifties, sixties, seventies, eighties, and nineties. Among the top 50 are 2 from the 1930’s, 4 from the 1940’s, 5 from the 1950’s, 9 from the 1960’s, 11 from the 1970’s, 7 from the 1980’s, 7 from the 1990’s, and 4 so far from the 2000’s. So there is perhaps a bit of a peak here, but it is not a dramatic one, especially as the figures are biased towards pre-1980 films which have had multiple releases (Disney animations in particular). So movies do not seem to show the same waning blockbuster effect as music. Instead, Anderson points to the waning total theatergoing audience, which seems to me a different phenomenon entirely.</p>
<p>On TV he has a stronger case - the waning of network TV in the US means that “the number one show today wouldn’t have made the top ten in 1970”. But what about books, the other area of entertainment/culture that he talks about a lot? He doesn’t say. The bestselling books of all time are books such as the Bible and Quotations from Chairman Mao, which don’t tell us a lot about book-buying habits in the sense he is looking for. A best-selling book can sell for years, decades, or more, giving Beatrix Potter’s Peter Rabbit a head start over Asterix. So although I do feel sceptical about the fall-off of blockbuster books (Da Vinci Code and Harry Potter anyone?) I’ll give him a break here.</p>
<p>Returning to movies for a moment, there are other sides of the movie industry which tell a different story from the one that Anderson is telling. Peter Grant and Chris Wood’s 2004 book <a href="http://www.douglas-mcintyre.com/book_details.asp?b=952">Blockbusters and Trade Wars</a> explains how (p 76) the era of the blockbuster started with Jaws. Before then, most movies launched in a “rolling opening” screening in major cities first and smaller centres later. Jaws opened on 460 screens - a big change. By 1995 however, “virtually all of the 150 or so movies released by major studios in the United States and Canada opened in more than 800 screens. By the turn of the century, 2,000- to 3,000-screen openings were commonplace. In 2001, Harry Potter and the Sorcerer’s Stone opened in the United States on a breathtaking 8,200 screens – nearly a quarter of all the theatres in America. On its opening weekend in Canada that year, Goldmember managed to seat an even more astonishing 52 per cent of all admissions”. Here is a different story - if blockbusters are waning, it is not because we have more choice but because they are living a shorter time, rolling over ever more urgently to make way for the next big opening. Anderson skips over these other consequences of the increasing returns to scale of digital production.</p>
<p>Anderson’s conclusion, then, is that hits “are not quite the economic force they used to be”. More dramatically, he goes on to say “Where are those fickle consumers going instead? No single place. They are scattered to the winds as markets fragment into countless niches.” At this stage in the book, the reader can only say “well, we’ll see.” He hasn’t proven his case yet, that’s for sure.</p>
<p><strong>iTunes Killed the Radio Star</strong> [2-6] contrasts Anderson’s own upbringing in the ’70s and ’80s with a modern teenager. The difference is simple: “The main difference between Ben’s adolecence and my own is simply choice. I was limited to what was broadcast over the airwaves. He’s got the Internet.” Now let’s be clear: the Internet is a big thing. It is changing much about this world, including adolescent lives. It’s going to change more. Some of the changes will be profound, some banal, some specialist, some pervasive - and it’s only just starting. It is the multifaceted nature of the changes it is bringing that make comparisons dangerous. When Anderson says “He plays video games with friends, mostly online” he is confirming that one change is that play has shifted from the streets, from friends homes, to the computer screen and networks. So to compare Broadcast TV to “The Internet” is misleading. This is something I’ll return to in later chapters, but what he is describing is not so much an increase in choice as a shift in choices. Some choices (playing in the street) have basically been lost, while others have risen to take their place. Just because these new options travel over the same network as online newspapers does not change the fact that it’s just another form of playing with friends.</p>
<p>What’s more, Anderson’s description of his mass culture youth, hemmed in by the small number of rock stations, and by an inability to explore outside the mainstream, is just not plausible. I mean, I was there. I grew up in the ’70s on the edge of Leeds, a middle-sized provincial city in the UK, and went to school in a town of 13,000 people. This was not a cutting edge environment, but even within that I was behind the times - unfashionable, with a narrow taste in music and a conformist taste in clothes. But even I managed, despite my best efforts, to be exposed to non-mainstream culture. The biggest band of the mid-’70s was Led Zeppelin, who thrived despite never being played on radio. My own particular favourite was Pink Floyd (ditto) but there were minor bands a plenty (Wishbone Ash anyone? Hawkwind?) My friend Matthew was into German techno-rock: Tangerine Dream and Kraftwerk. And that was before punk shook everyone up. So to portray this world as devoid of anything but the mainstream is, frankly, ridiculous.</p>
<p>But let’s leave my teenage years behind quickly and go back to the book. A section called “The 98 Percent Rule” [6-10] describes the beginnings of the book. The rule is based on a conversation he had with the CEO of Ecast, a digital jukebox company. This CEO pointed o ut that 98% of all their 10,000 albums had sold at least one track per quarter (three-month period). Anderson is stunned at the variety of people’s tastes when unencumbered by the physical limitations of old jukeboxes. This 98 percent rule is that just about anything you can offer for sale will find a buyer, so if you can (in a digital world) offer everything, then you can make money off all those items that sell a few here and there. Hits still matter, but “What if the non-hits–from healthy niche products to outright misses–all together added up to a market as big as, if not bigger than, the hits themselves?” [8].</p>
<p>One reviewer who has challenged this part of the book is Wall Street Journal’s Lee Gomes. Gomes argues (<a href="http://online.wsj.com/public/article/SB115387606762117314-Inp5lUxHwVDwS_SJv5zaQShPXlE_20070726.html">here</a> ) that whereas Anderson claims the 98% rule to be “nearly universal” citing iTunes, Netflix, Amazon and others (“And so it went, from company to company”), Gomes himself found something different:</p>
<blockquote class="blockquote">
<p>But when I looked online, I was surprised to see what seemed like the opposite. Ecast says 10% of its songs account for roughly 90% of its streams; monthly data from Rhapsody showed the top 10% songs getting 86% of streams. &gt; &gt;</p>
<blockquote class="blockquote">
<p>Bloglines, the widely used blog-reading tool, lists 1.2 million blogs; real ones, not computer-generated “spam blogs.” The top 10% of feeds grab 88% of all subscriptions. And 35% have no current subscribers at all – there’s clearly no 98 Percent Rule in the blogosphere.</p>
<p>At Apple’s iTunes, one person who has seen the data – which Apple doesn’t disclose – said sales “closely track Billboard. It’s a hits business. The data tend to refute ‘The Long Tail.’”</p>
<p>Other economists, of course, are looking into these same questions, though some seem to be reaching far more restrained conclusions. Harvard’s Anita Elberse, whom Mr.&nbsp;Anderson said was a consultant during his two-year research project, studies the video sales market, both online and off.</p>
<p>She said in an email that her work to date shows a “slight shift” toward the tail. But she also noted “a rapidly increasing number of titles that never, or very rarely, sell,” which suggests “it is difficult for content providers to profit from the ‘tail.’”</p>
<p>It would be wonderful if the world as Mr.&nbsp;Anderson describes it were true: one where “healthy niche products” and even “outright misses” collectively could stand their ground with the culture’s increasingly soulless “hits.”</p>
<p>But while every singer-songwriter dreams from his bedroom of making a living off iTunes, few actually do, mostly because so many others have the very same idea. And to the extent that Apple is making money off iTunes, thanks go to Nelly Furtado and other hitmakers. Indeed, you can make the case that the Internet is amplifying the role of hits, even in relation to misses, not diminishing them.</p>
</blockquote>
</blockquote>
<p>Anderson responds on his <a href="http://www.longtail.com/the_long_tail/2006/07/factchecking_my.html">weblog</a> but while there is dispute over other portions of the book (and we’ll get to those in a few posts time) he doesn’t challenge this part so far. The 98 percent rule seems to be a rule that is often broken.</p>
<p>Anderson himself replaced the phrasing of “98 percent rule” with “The Long Tail” as he continued his work. The point to make here is that in the introduction, despite some intriguing-sounding stories and some big claims, he has not demonstrated that a “Long Tail effect” actually exists. This matters.</p>
<p><strong>Tails Everywhere</strong> [10-11] is one of two places where the book goes seriously off the rails. As we’ll see, for most of the book the meaning of “The Long Tail” is fairly clear, but every now and then Anderson seems to get carried away and treat it as just another word for “variety”. So here he says “People often ask me to name some product category that does not lend itself to Long Tail economics. My usual answer is that it would be in some undifferentiated commodity, where variety is not only absent but unwanted. Like for instance, flour… Then I happened to step inside our local Whole Foods grocery and realized how wrong I was: Today the grocery carries more than twenty different types of flour… There is, amazingly enough, already a Long Tail in flour.” [11] This passage has two large faults. First, it clearly implies that Anderson sees the logic of the Long Tail, most of which is about media and entertainment industries, as extending to pretty much all of economics – “The Future of Business”. Also, he sees it as stretching beyond the digital world. Yet here (and again we’ll come back to this when he explains in more detail what he means by a Long Tail effect) he seems to be saying that the mere presence of a variety of goods is sufficient to indicate a change. You have to wonder, does 37 brands of toothpaste reflect a long tail in toothpaste? And what if (something he doesn’t mention) they all come from two companies? If he is going to argue that Long Tail simply means the emergence of niche markets then he has to demonstrate that a change is happening, whereby niche markets are becoming more important. Once more, at least in his introduction, he does not do this.</p>
<p><strong>A Preview Of Twenty-First-Century Economics</strong> [11-13] sets out how Anderson sees his book. First, he sees it as an economics research project (among other things). He’s doing economic research that “very few economists” [12] are doing, and venturing into “uncharted waters”. “Some of the data in this book” he says “has never before seen the light of day”. Anderson claims his role is to “synthesize the results [of the efforts of online entrepreneurs] into a framework. That is, of course, what economics does: It seeks to find neat, easily understood frameworks that describe real-world phenomena”. So this is an economics research book, he says.</p>
<p>Let’s sum up what I’ve seen in the introduction. It has some nice sentences, some big claims, but is already showing at least three potential problems. First, he is so far unable to substantiate his claim that the era of blockbusters is waning and that the “mass-culture era” [2] of the ’70s and ’80s has given way to a world of niche cultures. Second, his 98 percent rule seems dubious. Third, he is claiming to have a book of research that sets the stage for the future of business and twenty-first century economics – he is setting the bar high. Can he clear it? Let’s see…</p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>2023 – 2024, Tom Slee</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>